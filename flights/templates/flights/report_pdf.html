<!DOCTYPE html>
<html>
<head>
    <style>
        @page {
            size: A4;
            margin: 1cm;
            @frame footer_frame {
                -pdf-frame-content: footerContent;
                bottom: 0cm;
                margin-left: 1cm;
                margin-right: 1cm;
                height: 1cm;
            }
        }

        body { font-family: Helvetica, sans-serif; font-size: 10pt; color: #333333; }

        /* Header */
        .header-table { width: 100%; margin-bottom: 20px; border-bottom: 2px solid #0d6efd; padding-bottom: 10px; }
        .brand { font-size: 24pt; color: #0d6efd; font-weight: bold; }
        .report-title { font-size: 16pt; color: #555; text-align: right; }
        .meta-info { font-size: 9pt; color: #777; text-align: right; margin-top: 5px; }

        /* Summary Cards */
        .cards-table { width: 100%; margin-bottom: 30px; }
        .card-cell { width: 48%; }
        .spacer-cell { width: 4%; }
        
        .card {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .card-label { font-size: 9pt; text-transform: uppercase; color: #666; margin-bottom: 5px; font-weight: bold; }
        .card-value { font-size: 18pt; font-weight: bold; color: #333; }
        .card-value.tickets { color: #0d6efd; }
        .card-value.flights { color: #ffc107; }

        /* Data Table */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        
        /* FIX: Removed borders from TH to prevent double-border glitches in PDF */
        .data-table th {
            background-color: #0d6efd; color: #ffffff; font-weight: bold; padding: 8px; text-align: left; font-size: 9pt;
        }
        .data-table td {
            padding: 8px; border-bottom: 1px solid #eeeeee; font-size: 9pt; vertical-align: middle;
        }
        .data-table tr:nth-child(even) { background-color: #fcfcfc; }

        .badge { font-size: 8pt; padding: 3px 6px; border-radius: 4px; color: white; }
        .bg-primary { color: #0d6efd; } .bg-danger { color: #dc3545; } .bg-success { color: #198754; } .bg-secondary { color: #6c757d; }

    </style>
</head>
<body>

    <table class="header-table">
        <tr>
            <td valign="bottom"><span class="brand">FlightSystem</span></td>
            <td valign="bottom" align="right">
                <div class="report-title">{{ report_type|title }} Report</div>
                <div class="meta-info">
                    Generated by: {{ user.first_name }} {{ user.last_name }}<br/>
                    Date: {{ generated_at|date:"F d, Y" }}
                </div>
            </td>
        </tr>
    </table>

    <table class="cards-table">
        <tr>
            <td class="card-cell">
                <div class="card">
                    <div class="card-label">Total Flights</div>
                    <div class="card-value flights">{{ total_flights }}</div>
                </div>
            </td>
            <td class="spacer-cell"></td>
            
            <td class="card-cell">
                <div class="card">
                    <div class="card-label">Tickets Sold</div>
                    <div class="card-value tickets">{{ total_tickets }}</div>
                </div>
            </td>
        </tr>
    </table>

    <h3 style="color: #333; border-left: 5px solid #0d6efd; padding-left: 10px; margin-bottom: 10px;">
        Detailed Breakdown
    </h3>

    <table class="data-table">
        <colgroup>
            {% if report_type == 'occupancy' %}
                <col width="15%"> <col width="20%"> <col width="20%"> <col width="15%"> <col width="15%"> <col width="15%"> {% elif report_type == 'financial' %}
                <col width="15%"> <col width="20%"> <col width="20%"> <col width="15%"> <col width="15%"> <col width="15%"> <col width="20%"> {% else %}
                <col width="15%"> <col width="20%"> <col width="20%"> <col width="15%"> <col width="15%"> <col width="15%"> {% if show_financials %}
                <col width="20%"> {% endif %}
            {% endif %}
        </colgroup>
        
        <thead>
            <tr>
                <th>Flight No</th>
                <th>Route</th>
                <th>Date</th>
                {% if report_type == 'occupancy' %}
                    <th>Capacity</th>
                    <th>Sold</th>
                    <th>Load %</th>
                {% elif report_type == 'financial' %}
                    <th>Economy</th>
                    <th>Business</th>
                    <th>First</th>
                    <th>Revenue</th>
                {% else %}
                    <th>Status</th>
                    <th>Sold</th>
                    <th>Load %</th>
                    {% if show_financials %}
                    <th>Revenue</th>
                    {% endif %}
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in flight_data %}
            <tr>
                <td style="font-weight: bold; color: #0d6efd;">{{ item.flight.flight_number }}</td>
                <td>{{ item.flight.departure_airport.airport_code }} &rarr; {{ item.flight.arrival_airport.airport_code }}</td>
                <td>{{ item.flight.departure_datetime|date:"Y-m-d" }}</td>

                {% if report_type == 'occupancy' %}
                    <td>{{ item.capacity }}</td>
                    <td>{{ item.sold }}</td>
                    <td>{{ item.occupancy }}%</td>
                {% elif report_type == 'financial' %}
                    <td>{{ item.eco_sold }}</td>
                    <td>{{ item.bus_sold }}</td>
                    <td>{{ item.first_sold }}</td>
                    <td style="font-weight: bold; color: #198754;">{{ item.revenue }}</td>
                {% else %}
                    <td>
                        {% if item.status == 'Scheduled' %}
                            <span style="color: #0d6efd;">Scheduled</span>
                        {% elif item.status == 'Cancelled' %}
                            <span style="color: #dc3545;">Cancelled</span>
                        {% elif item.status == 'Landed' %}
                            <span style="color: #198754;">Landed</span>
                        {% else %}
                            <span style="color: #6c757d;">{{ item.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ item.sold }}</td>
                    <td>{{ item.occupancy }}%</td>
                    
                    {% if show_financials %}
                        <td style="color: #198754; font-weight: bold;">{{ item.revenue }}</td>
                    {% endif %}
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id="footerContent" style="text-align: center; color: #999; font-size: 8pt;">
        Confidential Report | Generated by Flight Management System | Page <pdf:pagenumber>
    </div>

</body>
</html>